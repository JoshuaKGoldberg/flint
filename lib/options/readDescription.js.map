{"version":3,"file":"readDescription.js","names":[],"sources":["../../src/options/readDescription.ts"],"sourcesContent":["import { marked } from \"marked\";\n\nimport { packageData } from \"../data/packageData.js\";\nimport { PartialPackageData } from \"../types.js\";\nimport { htmlToTextSafe } from \"../utils/htmlToTextSafe.js\";\nimport { readDescriptionFromReadme } from \"./readDescriptionFromReadme.js\";\n\nexport async function readDescription(\n\tgetPackageData: () => Promise<PartialPackageData>,\n\tgetReadme: () => Promise<string>,\n\tgetRepository: () => Promise<string | undefined>,\n) {\n\t// If we there is no package.json yet, this is probably setup mode.\n\tconst { description: fromPackageJson } = await getPackageData();\n\tif (!fromPackageJson) {\n\t\treturn undefined;\n\t}\n\n\t// If only a a package.json exists, this is probably transition mode.\n\t// We can use the package.json's description as the only source of truth.\n\tconst fromReadme = await readDescriptionFromReadme(getReadme);\n\tif (!fromReadme) {\n\t\treturn marked.parseInline(fromPackageJson);\n\t}\n\n\t// If the package.json is create-typescript-app's but the repository isn't,\n\t// we're almost certainly in transition mode after cloning the template.\n\tif (\n\t\t(await getRepository()) !== \"create-typescript-app\" &&\n\t\tfromPackageJson === packageData.description\n\t) {\n\t\treturn undefined;\n\t}\n\n\tconst fromPackageJsonNormalized = htmlToTextSafe(\n\t\tawait marked.parseInline(fromPackageJson),\n\t);\n\tconst fromReadmeNormalized = htmlToTextSafe(fromReadme);\n\n\t// If the package.json and README.md don't match, we prefer the package.json,\n\t// as it's what is used in publishing to npm.\n\tif (fromReadmeNormalized !== fromPackageJsonNormalized) {\n\t\treturn await marked.parseInline(fromPackageJson);\n\t}\n\n\t// Otherwise, if they do match, the README.md may have more rich HTML text.\n\treturn fromReadme;\n}\n"],"mappings":";;;;;;AAOA,eAAsB,gBACrB,gBACA,WACA,eACC;CAED,MAAM,EAAE,aAAa,oBAAoB,MAAM,gBAAgB;AAC/D,KAAI,CAAC,gBACJ;CAKD,MAAM,aAAa,MAAM,0BAA0B,UAAU;AAC7D,KAAI,CAAC,WACJ,QAAO,OAAO,YAAY,gBAAgB;AAK3C,KACE,MAAM,eAAe,KAAM,2BAC5B,oBAAoB,YAAY,YAEhC;CAGD,MAAM,4BAA4B,eACjC,MAAM,OAAO,YAAY,gBAAgB,CACzC;AAKD,KAJ6B,eAAe,WAAW,KAI1B,0BAC5B,QAAO,MAAM,OAAO,YAAY,gBAAgB;AAIjD,QAAO"}