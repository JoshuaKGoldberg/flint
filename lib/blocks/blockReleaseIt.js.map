{"version":3,"file":"blockReleaseIt.js","names":[],"sources":["../../src/blocks/blockReleaseIt.ts"],"sourcesContent":["import { z } from \"zod\";\n\nimport { base } from \"../base.js\";\nimport { getPackageDependencies } from \"../data/packageData.js\";\nimport { resolveUses } from \"./actions/resolveUses.js\";\nimport { blockPackageJson } from \"./blockPackageJson.js\";\nimport { blockREADME } from \"./blockREADME.js\";\nimport { blockRepositorySecrets } from \"./blockRepositorySecrets.js\";\nimport { createSoloWorkflowFile } from \"./files/createSoloWorkflowFile.js\";\n\nexport const blockReleaseIt = base.createBlock({\n\tabout: {\n\t\tname: \"release-it\",\n\t},\n\taddons: {\n\t\tbuilders: z\n\t\t\t.array(\n\t\t\t\tz.object({\n\t\t\t\t\torder: z.number(),\n\t\t\t\t\trun: z.string(),\n\t\t\t\t}),\n\t\t\t)\n\t\t\t.default([]),\n\t},\n\tproduce({ addons, options }) {\n\t\tconst { builders } = addons;\n\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockPackageJson({\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdevDependencies: getPackageDependencies(\n\t\t\t\t\t\t\t\"@release-it/conventional-changelog\",\n\t\t\t\t\t\t\t\"release-it\",\n\t\t\t\t\t\t),\n\t\t\t\t\t\tpublishConfig: {\n\t\t\t\t\t\t\tprovenance: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tscripts: {\n\t\t\t\t\t\t\t\"should-semantic-release\": undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockREADME({\n\t\t\t\t\tbadges: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\talt: \"ðŸ“¦ npm version\",\n\t\t\t\t\t\t\thref: `http://npmjs.com/package/${options.repository}`,\n\t\t\t\t\t\t\tsrc: `https://img.shields.io/npm/v/${options.repository}?color=21bb42&label=%F0%9F%93%A6%20npm`,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockRepositorySecrets({\n\t\t\t\t\tsecrets: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdescription: \"a GitHub PAT with repo and workflow permissions\",\n\t\t\t\t\t\t\tname: \"ACCESS_TOKEN\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdescription: \"an npm access token with automation permissions\",\n\t\t\t\t\t\t\tname: \"NPM_TOKEN\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t\".github\": {\n\t\t\t\t\tworkflows: {\n\t\t\t\t\t\t\"post-release.yaml\": createSoloWorkflowFile({\n\t\t\t\t\t\t\tname: \"Post Release\",\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\trelease: {\n\t\t\t\t\t\t\t\t\ttypes: [\"published\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\tissues: \"write\",\n\t\t\t\t\t\t\t\t\"pull-requests\": \"write\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"actions/checkout\",\n\t\t\t\t\t\t\t\t\t\t\"v4\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\twith: { \"fetch-depth\": 0 },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trun: `echo \"npm_version=$(npm pkg get version | tr -d '\"')\" >> \"$GITHUB_ENV\"`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"apexskier/github-release-commenter\",\n\t\t\t\t\t\t\t\t\t\t\"v1\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\"comment-template\": `\n\t\t\t\t\t\t\t:tada: This is included in version {release_link} :tada:\n\n\t\t\t\t\t\t\tThe release is available on:\n\n\t\t\t\t\t\t\t* [GitHub releases](https://github.com/${options.owner}/${options.repository}/releases/tag/{release_tag})\n\t\t\t\t\t\t\t* [npm package (@latest dist-tag)](https://www.npmjs.com/package/${options.repository}/v/\\${{ env.npm_version }})\n\n\t\t\t\t\t\t\tCheers! ðŸ“¦ðŸš€\n\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\t\tGITHUB_TOKEN: \"${{ secrets.GITHUB_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"release.yaml\": createSoloWorkflowFile({\n\t\t\t\t\t\t\tconcurrency: {\n\t\t\t\t\t\t\t\tgroup: \"${{ github.workflow }}\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: \"Release\",\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tpush: {\n\t\t\t\t\t\t\t\t\tbranches: [\"main\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\tcontents: \"write\",\n\t\t\t\t\t\t\t\t\"id-token\": \"write\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"actions/checkout\",\n\t\t\t\t\t\t\t\t\t\t\"v4\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\"fetch-depth\": 0,\n\t\t\t\t\t\t\t\t\t\tref: \"main\",\n\t\t\t\t\t\t\t\t\t\ttoken: \"${{ secrets.ACCESS_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tuses: \"./.github/actions/prepare\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t...builders\n\t\t\t\t\t\t\t\t\t.sort((a, b) => a.order - b.order)\n\t\t\t\t\t\t\t\t\t.map(({ run }) => ({ run })),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tenv: {\n\t\t\t\t\t\t\t\t\t\tGITHUB_TOKEN: \"${{ secrets.ACCESS_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t\tNPM_TOKEN: \"${{ secrets.NPM_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"JoshuaKGoldberg/release-it-action\",\n\t\t\t\t\t\t\t\t\t\t\"v0.3.2\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t\".release-it.json\": JSON.stringify({\n\t\t\t\t\tgit: {\n\t\t\t\t\t\tcommitMessage: \"chore: release v${version}\",\n\t\t\t\t\t\trequireCommits: true,\n\t\t\t\t\t},\n\t\t\t\t\tgithub: {\n\t\t\t\t\t\trelease: true,\n\t\t\t\t\t\treleaseName: \"v${version}\",\n\t\t\t\t\t},\n\t\t\t\t\tnpm: {\n\t\t\t\t\t\tpublishArgs: [`--access ${options.access}`, \"--provenance\"],\n\t\t\t\t\t},\n\t\t\t\t\tplugins: {\n\t\t\t\t\t\t\"@release-it/conventional-changelog\": {\n\t\t\t\t\t\t\tinfile: \"CHANGELOG.md\",\n\t\t\t\t\t\t\tpreset: \"conventionalcommits\",\n\t\t\t\t\t\t\ttypes: [\n\t\t\t\t\t\t\t\t{ section: \"Features\", type: \"feat\" },\n\t\t\t\t\t\t\t\t{ section: \"Bug Fixes\", type: \"fix\" },\n\t\t\t\t\t\t\t\t{ section: \"Performance Improvements\", type: \"perf\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"build\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"chore\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"ci\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"docs\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"refactor\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"style\" },\n\t\t\t\t\t\t\t\t{ hidden: true, type: \"test\" },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t},\n\t\t};\n\t},\n});\n"],"mappings":"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"}