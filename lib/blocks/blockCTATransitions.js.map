{"version":3,"file":"blockCTATransitions.js","names":[],"sources":["../../src/blocks/blockCTATransitions.ts"],"sourcesContent":["import { base } from \"../base.js\";\nimport { packageData } from \"../data/packageData.js\";\nimport { resolveUses } from \"./actions/resolveUses.js\";\nimport { blockPackageJson } from \"./blockPackageJson.js\";\nimport { blockRepositoryBranchRuleset } from \"./blockRepositoryBranchRuleset.js\";\nimport { createSoloWorkflowFile } from \"./files/createSoloWorkflowFile.js\";\nimport { formatYaml } from \"./files/formatYaml.js\";\n\nexport const blockCTATransitions = base.createBlock({\n\tabout: {\n\t\tname: \"CTA Transitions\",\n\t},\n\tproduce({ options }) {\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockPackageJson({\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdevDependencies: {\n\t\t\t\t\t\t\t\"create-typescript-app\": packageData.version,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockRepositoryBranchRuleset({\n\t\t\t\t\trequiredStatusChecks: [\"Transition\"],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t\".github\": {\n\t\t\t\t\tactions: {\n\t\t\t\t\t\ttransition: {\n\t\t\t\t\t\t\t\"action.yaml\": formatYaml({\n\t\t\t\t\t\t\t\tdescription: \"Runs create-typescript-app in transition mode\",\n\t\t\t\t\t\t\t\tinputs: {\n\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\"GitHub personal access token with repo, workflow, and read:org permissions.\",\n\t\t\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tname: \"Transition\",\n\t\t\t\t\t\t\t\truns: {\n\t\t\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t\t\t{ uses: \"./.github/actions/prepare\" },\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\trun: \"npx create-typescript-app\",\n\t\t\t\t\t\t\t\t\t\t\tshell: \"bash\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tid: \"auto-commit-action\",\n\t\t\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\t\t\"stefanzweifel/git-auto-commit-action\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"v5\",\n\t\t\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\t\tcommit_author:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"The Friendly Bingo Bot <bot@create.bingo>\",\n\t\t\t\t\t\t\t\t\t\t\t\tcommit_message:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Check in changes from re-running npx create-typescript-app\",\n\t\t\t\t\t\t\t\t\t\t\t\tcommit_user_email: \"bot@create.bingo\",\n\t\t\t\t\t\t\t\t\t\t\t\tcommit_user_name: \"The Friendly Bingo Bot\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tif: \"steps.auto-commit-action.outputs.changes_detected == 'true'\",\n\t\t\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\t\t\"mshick/add-pr-comment\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"v2\",\n\t\t\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\t\tissue: \"${{ github.event.pull_request.number }}\",\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"ü§ñ Beep boop! I ran `npx create-typescript-app` and it updated some files.\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"I went ahead and checked those changes into this PR for you. Please review the latest commit to see if you want to merge it.\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Cheers!\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\" ‚Äî _The Friendly Bingo Bot_ üíù\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"> ‚ÑπÔ∏è These automatic commits keep your repository up-to-date with new versions of [create-typescript-app](https://github.com/JoshuaKGoldberg/create-typescript-app). If you want to opt out, delete your `.github/workflows/cta-transitions.yaml` file.\",\n\t\t\t\t\t\t\t\t\t\t\t\t].join(\"\\n\"),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tid: \"package-change\",\n\t\t\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\t\t\"JoshuaKGoldberg/package-change-detector-action\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"0.1.0\",\n\t\t\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: \"engines\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tif: `steps.package-change.outputs.changed == 'true'`,\n\t\t\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\t\t\"JoshuaKGoldberg/draft-pull-request-once-action\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"0.0.1\",\n\t\t\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"github-token\": \"${{ inputs.token }}\",\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"ü§ñ Beep boop! This PR changes the `engines` field in `package.json`. That might be a breaking change. It's been set to a draft so that it doesn't automatically merge. Go ahead and un-draft the PR if the change is ready for release.\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Cheers!\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\" ‚Äî _The Friendly Bingo Bot_ üíù\",\n\t\t\t\t\t\t\t\t\t\t\t\t].join(\"\\n\"),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tusing: \"composite\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tworkflows: {\n\t\t\t\t\t\t\"cta.yaml\": createSoloWorkflowFile({\n\t\t\t\t\t\t\tjobName: \"Transition\",\n\t\t\t\t\t\t\tname: \"CTA\",\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tpull_request: {\n\t\t\t\t\t\t\t\t\tbranches: [\"main\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\t\"pull-requests\": \"write\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: \"checkout\",\n\t\t\t\t\t\t\t\t\tif: `(github.actor == '${options.owner}' || github.actor == 'renovate[bot]') && startsWith(github.head_ref, 'renovate/') && contains(github.event.pull_request.title, 'create-typescript-app')`,\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"actions/checkout\",\n\t\t\t\t\t\t\t\t\t\t\"v4\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\t\"fetch-depth\": 0,\n\t\t\t\t\t\t\t\t\t\tref: \"${{github.event.pull_request.head.ref}}\",\n\t\t\t\t\t\t\t\t\t\trepository:\n\t\t\t\t\t\t\t\t\t\t\t\"${{github.event.pull_request.head.repo.full_name}}\",\n\t\t\t\t\t\t\t\t\t\ttoken: \"${{ secrets.ACCESS_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif: \"steps.checkout.outcome != 'skipped'\",\n\t\t\t\t\t\t\t\t\tuses: \"./.github/actions/transition\",\n\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\ttoken: \"${{ secrets.ACCESS_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif: \"steps.checkout.outcome == 'skipped'\",\n\t\t\t\t\t\t\t\t\trun: \"echo 'Skipping transition mode because the PR does not appear to be an automated or owner-created update to create-typescript-app.'\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;;AAQA,MAAa,sBAAsB,KAAK,YAAY;CACnD,OAAO,EACN,MAAM,mBACN;CACD,QAAQ,EAAE,WAAW;AACpB,SAAO;GACN,QAAQ,CACP,iBAAiB,EAChB,YAAY,EACX,iBAAiB,EAChB,yBAAyB,YAAY,SACrC,EACD,EACD,CAAC,EACF,6BAA6B,EAC5B,sBAAsB,CAAC,aAAa,EACpC,CAAC,CACF;GACD,OAAO,EACN,WAAW;IACV,SAAS,EACR,YAAY,EACX,eAAe,WAAW;KACzB,aAAa;KACb,QAAQ,EACP,OAAO;MACN,aACC;MACD,UAAU;MACV,EACD;KACD,MAAM;KACN,MAAM;MACL,OAAO;OACN,EAAE,MAAM,6BAA6B;OACrC;QACC,KAAK;QACL,OAAO;QACP;OACD;QACC,IAAI;QACJ,MAAM,YACL,wCACA,MACA,QAAQ,kBACR;QACD,MAAM;SACL,eACC;SACD,gBACC;SACD,mBAAmB;SACnB,kBAAkB;SAClB;QACD;OACD;QACC,IAAI;QACJ,MAAM,YACL,yBACA,MACA,QAAQ,kBACR;QACD,MAAM;SACL,OAAO;SACP,SAAS;UACR;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA,CAAC,KAAK,KAAK;SACZ;QACD;OACD;QACC,IAAI;QACJ,MAAM,YACL,kDACA,SACA,QAAQ,kBACR;QACD,MAAM,EACL,YAAY,WACZ;QACD;OACD;QACC,IAAI;QACJ,MAAM,YACL,kDACA,SACA,QAAQ,kBACR;QACD,MAAM;SACL,gBAAgB;SAChB,SAAS;UACR;UACA;UACA;UACA;UACA,CAAC,KAAK,KAAK;SACZ;QACD;OACD;MACD,OAAO;MACP;KACD,CAAC,EACF,EACD;IACD,WAAW,EACV,YAAY,uBAAuB;KAClC,SAAS;KACT,MAAM;KACN,IAAI,EACH,cAAc,EACb,UAAU,CAAC,OAAO,EAClB,EACD;KACD,aAAa,EACZ,iBAAiB,SACjB;KACD,OAAO;MACN;OACC,IAAI;OACJ,IAAI,qBAAqB,QAAQ,MAAM;OACvC,MAAM,YACL,oBACA,MACA,QAAQ,kBACR;OACD,MAAM;QACL,eAAe;QACf,KAAK;QACL,YACC;QACD,OAAO;QACP;OACD;MACD;OACC,IAAI;OACJ,MAAM;OACN,MAAM,EACL,OAAO,+BACP;OACD;MACD;OACC,IAAI;OACJ,KAAK;OACL;MACD;KACD,CAAC,EACF;IACD,EACD;GACD;;CAEF,CAAC"}