{"version":3,"file":"blockKnip.js","names":[],"sources":["../../src/blocks/blockKnip.ts"],"sourcesContent":["import removeUndefinedObjects from \"remove-undefined-objects\";\nimport { z } from \"zod\";\n\nimport { base } from \"../base.js\";\nimport {\n\tgetPackageDependencies,\n\tgetPackageDependency,\n} from \"../data/packageData.js\";\nimport { blockDevelopmentDocs } from \"./blockDevelopmentDocs.js\";\nimport { blockGitHubActionsCI } from \"./blockGitHubActionsCI.js\";\nimport { blockPackageJson } from \"./blockPackageJson.js\";\nimport { blockRemoveFiles } from \"./blockRemoveFiles.js\";\nimport { blockRemoveWorkflows } from \"./blockRemoveWorkflows.js\";\nimport { intakeFileAsJson } from \"./intake/intakeFileAsJson.js\";\n\nconst zStringArray = z.array(z.string());\n\nexport const blockKnip = base.createBlock({\n\tabout: {\n\t\tname: \"Knip\",\n\t},\n\taddons: {\n\t\tentry: zStringArray.optional(),\n\t\tignoreDependencies: zStringArray.optional(),\n\t\tproject: zStringArray.optional(),\n\t},\n\tintake({ files }) {\n\t\tconst knipJson = intakeFileAsJson(files, [\"knip.json\"]);\n\t\tif (!knipJson) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn removeUndefinedObjects({\n\t\t\tentry: zStringArray.safeParse(knipJson.entry).data,\n\t\t\tignoreDependencies: zStringArray.safeParse(knipJson.ignoreDependencies)\n\t\t\t\t.data,\n\t\t\tproject: zStringArray.safeParse(knipJson.project).data,\n\t\t});\n\t},\n\tproduce({ addons }) {\n\t\tconst { entry, ignoreDependencies, project } = addons;\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockDevelopmentDocs({\n\t\t\t\t\tsections: {\n\t\t\t\t\t\tLinting: {\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t\t`- \\`pnpm lint:knip\\` ([knip](https://github.com/webpro/knip)): Detects unused files, dependencies, and code exports`,\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockGitHubActionsCI({\n\t\t\t\t\tjobs: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"Lint Knip\",\n\t\t\t\t\t\t\tsteps: [{ run: \"pnpm lint:knip\" }],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockPackageJson({\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdevDependencies: getPackageDependencies(\"knip\"),\n\t\t\t\t\t\tscripts: {\n\t\t\t\t\t\t\t\"lint:knip\": \"knip\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockRemoveFiles({\n\t\t\t\t\tfiles: [\".ts-prunerc*\"],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t\"knip.json\": JSON.stringify({\n\t\t\t\t\t$schema: `https://unpkg.com/knip@${getPackageDependency(\"knip\")}/schema.json`,\n\t\t\t\t\tentry: entry?.sort(),\n\t\t\t\t\tignoreDependencies,\n\t\t\t\t\tignoreExportsUsedInFile: {\n\t\t\t\t\t\tinterface: true,\n\t\t\t\t\t\ttype: true,\n\t\t\t\t\t},\n\t\t\t\t\tproject: project?.sort(),\n\t\t\t\t\ttreatConfigHintsAsErrors: true,\n\t\t\t\t}),\n\t\t\t},\n\t\t};\n\t},\n\ttransition() {\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockRemoveFiles({\n\t\t\t\t\tfiles: [\".knip*\", \"knip.{c,m,t}*\", \"knip.js\", \"knip.jsonc\"],\n\t\t\t\t}),\n\t\t\t\tblockRemoveWorkflows({\n\t\t\t\t\tworkflows: [\"knip\", \"lint-knip\"],\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;;;;;AAeA,MAAM,eAAe,EAAE,MAAM,EAAE,QAAQ,CAAC;AAExC,MAAa,YAAY,KAAK,YAAY;CACzC,OAAO,EACN,MAAM,QACN;CACD,QAAQ;EACP,OAAO,aAAa,UAAU;EAC9B,oBAAoB,aAAa,UAAU;EAC3C,SAAS,aAAa,UAAU;EAChC;CACD,OAAO,EAAE,SAAS;EACjB,MAAM,WAAW,iBAAiB,OAAO,CAAC,YAAY,CAAC;AACvD,MAAI,CAAC,SACJ;AAGD,SAAO,uBAAuB;GAC7B,OAAO,aAAa,UAAU,SAAS,MAAM,CAAC;GAC9C,oBAAoB,aAAa,UAAU,SAAS,mBAAmB,CACrE;GACF,SAAS,aAAa,UAAU,SAAS,QAAQ,CAAC;GAClD,CAAC;;CAEH,QAAQ,EAAE,UAAU;EACnB,MAAM,EAAE,OAAO,oBAAoB,YAAY;AAC/C,SAAO;GACN,QAAQ;IACP,qBAAqB,EACpB,UAAU,EACT,SAAS,EACR,UAAU,EACT,OAAO,CACN,sHACA,EACD,EACD,EACD,EACD,CAAC;IACF,qBAAqB,EACpB,MAAM,CACL;KACC,MAAM;KACN,OAAO,CAAC,EAAE,KAAK,kBAAkB,CAAC;KAClC,CACD,EACD,CAAC;IACF,iBAAiB,EAChB,YAAY;KACX,iBAAiB,uBAAuB,OAAO;KAC/C,SAAS,EACR,aAAa,QACb;KACD,EACD,CAAC;IACF,iBAAiB,EAChB,OAAO,CAAC,eAAe,EACvB,CAAC;IACF;GACD,OAAO,EACN,aAAa,KAAK,UAAU;IAC3B,SAAS,0BAA0B,qBAAqB,OAAO,CAAC;IAChE,OAAO,OAAO,MAAM;IACpB;IACA,yBAAyB;KACxB,WAAW;KACX,MAAM;KACN;IACD,SAAS,SAAS,MAAM;IACxB,0BAA0B;IAC1B,CAAC,EACF;GACD;;CAEF,aAAa;AACZ,SAAO,EACN,QAAQ,CACP,iBAAiB,EAChB,OAAO;GAAC;GAAU;GAAiB;GAAW;GAAa,EAC3D,CAAC,EACF,qBAAqB,EACpB,WAAW,CAAC,QAAQ,YAAY,EAChC,CAAC,CACF,EACD;;CAEF,CAAC"}