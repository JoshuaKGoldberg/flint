{"version":3,"file":"blockTSDown.js","names":[],"sources":["../../src/blocks/blockTSDown.ts"],"sourcesContent":["import removeUndefinedObjects from \"remove-undefined-objects\";\nimport { z } from \"zod\";\n\nimport { base } from \"../base.js\";\nimport { getPackageDependencies } from \"../data/packageData.js\";\nimport { blockDevelopmentDocs } from \"./blockDevelopmentDocs.js\";\nimport { blockESLint } from \"./blockESLint.js\";\nimport { blockGitHubActionsCI } from \"./blockGitHubActionsCI.js\";\nimport { blockKnip } from \"./blockKnip.js\";\nimport { blockPackageJson } from \"./blockPackageJson.js\";\nimport { blockReleaseIt } from \"./blockReleaseIt.js\";\nimport { blockRemoveDependencies } from \"./blockRemoveDependencies.js\";\nimport { blockRemoveFiles } from \"./blockRemoveFiles.js\";\nimport { blockRemoveWorkflows } from \"./blockRemoveWorkflows.js\";\nimport { intakeFileDefineConfig } from \"./intake/intakeFileDefineConfig.js\";\nimport { CommandPhase } from \"./phases.js\";\n\nconst zEntry = z.array(z.string());\nconst zProperties = z.record(z.unknown());\n\nexport const blockTSDown = base.createBlock({\n\tabout: {\n\t\tname: \"TSDown\",\n\t},\n\taddons: {\n\t\tentry: zEntry.default([]),\n\t\tproperties: zProperties.default({}),\n\t\trunInCI: z.array(z.string()).default([]),\n\t},\n\tintake({ files }) {\n\t\tconst rawData =\n\t\t\tintakeFileDefineConfig(files, [\"tsdown.config.ts\"]) ??\n\t\t\tintakeFileDefineConfig(files, [\"tsup.config.ts\"]);\n\t\tif (!rawData) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { entry: rawEntry, ...rest } = rawData;\n\n\t\treturn {\n\t\t\tentry: zEntry.safeParse(rawEntry).data,\n\t\t\tproperties: removeUndefinedObjects({\n\t\t\t\t...zProperties.safeParse(rest).data,\n\n\t\t\t\t// In case of a tsup.config.ts migrated to tsdown.config.ts\n\t\t\t\tbundle: undefined,\n\t\t\t\tclean: rest.clean === false ? false : undefined,\n\t\t\t\tformat: rest.format === \"esm\" ? undefined : rest.format,\n\t\t\t}),\n\t\t};\n\t},\n\tproduce({ addons, options }) {\n\t\tconst { entry, properties, runInCI } = addons;\n\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockDevelopmentDocs({\n\t\t\t\t\tsections: {\n\t\t\t\t\t\tBuilding: {\n\t\t\t\t\t\t\tcontents: `\nRun [**tsdown**](https://tsdown.dev) locally to build source files from \\`src/\\` into output files in \\`lib/\\`:\n\n\\`\\`\\`shell\npnpm build\n\\`\\`\\`\n\nAdd \\`--watch\\` to run the builder in a watch mode that continuously cleans and recreates \\`lib/\\` as you save files:\n\n\\`\\`\\`shell\npnpm build --watch\n\\`\\`\\`\n`,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockESLint({\n\t\t\t\t\tbeforeLint: `Note that you'll need to run \\`pnpm build\\` before \\`pnpm lint\\` so that lint rules which check the file system can pick up on any built files.`,\n\t\t\t\t}),\n\t\t\t\tblockGitHubActionsCI({\n\t\t\t\t\tjobs: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"Build\",\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{ run: \"pnpm build\" },\n\t\t\t\t\t\t\t\t...runInCI.map((run) => ({ run })),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockKnip({\n\t\t\t\t\tentry: [\"src/index.ts\"],\n\t\t\t\t}),\n\t\t\t\tblockPackageJson({\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdevDependencies: getPackageDependencies(\"tsdown\"),\n\t\t\t\t\t\tscripts: {\n\t\t\t\t\t\t\tbuild: \"tsdown\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockReleaseIt({\n\t\t\t\t\tbuilders: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\torder: 0,\n\t\t\t\t\t\t\trun: \"pnpm build\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t\"tsdown.config.ts\": `import { defineConfig } from \"tsdown\";\n\nexport default defineConfig(${JSON.stringify({\n\t\t\t\t\tdts: true,\n\t\t\t\t\tentry: Array.from(new Set([\"src/**/*.ts\", ...entry])),\n\t\t\t\t\tfixedExtension: false,\n\t\t\t\t\toutDir: \"lib\",\n\t\t\t\t\tunbundle: true,\n\t\t\t\t\t...properties,\n\t\t\t\t})});\n`,\n\t\t\t},\n\t\t\tscripts: options.bin\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcommands: [\"pnpm build\"],\n\t\t\t\t\t\t\tphase: CommandPhase.Build,\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t: undefined,\n\t\t};\n\t},\n\ttransition() {\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockRemoveDependencies({\n\t\t\t\t\tdependencies: [\n\t\t\t\t\t\t\"@babel/cli\",\n\t\t\t\t\t\t\"@babel/core\",\n\t\t\t\t\t\t\"@babel/preset-typescript\",\n\t\t\t\t\t\t\"babel\",\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockRemoveFiles({\n\t\t\t\t\tfiles: [\n\t\t\t\t\t\t\".babelrc*\",\n\t\t\t\t\t\t\"babel.config.*\",\n\t\t\t\t\t\t\"dist\",\n\t\t\t\t\t\t\"lib\",\n\t\t\t\t\t\t\"tsup.config.*\",\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockRemoveWorkflows({\n\t\t\t\t\tworkflows: [\"build\", \"tsup\"],\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;;;;;;;;;;AAiBA,MAAM,SAAS,EAAE,MAAM,EAAE,QAAQ,CAAC;AAClC,MAAM,cAAc,EAAE,OAAO,EAAE,SAAS,CAAC;AAEzC,MAAa,cAAc,KAAK,YAAY;CAC3C,OAAO,EACN,MAAM,UACN;CACD,QAAQ;EACP,OAAO,OAAO,QAAQ,EAAE,CAAC;EACzB,YAAY,YAAY,QAAQ,EAAE,CAAC;EACnC,SAAS,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC;EACxC;CACD,OAAO,EAAE,SAAS;EACjB,MAAM,UACL,uBAAuB,OAAO,CAAC,mBAAmB,CAAC,IACnD,uBAAuB,OAAO,CAAC,iBAAiB,CAAC;AAClD,MAAI,CAAC,QACJ;EAGD,MAAM,EAAE,OAAO,UAAU,GAAG,SAAS;AAErC,SAAO;GACN,OAAO,OAAO,UAAU,SAAS,CAAC;GAClC,YAAY,uBAAuB;IAClC,GAAG,YAAY,UAAU,KAAK,CAAC;IAG/B,QAAQ;IACR,OAAO,KAAK,UAAU,QAAQ,QAAQ;IACtC,QAAQ,KAAK,WAAW,QAAQ,SAAY,KAAK;IACjD,CAAC;GACF;;CAEF,QAAQ,EAAE,QAAQ,WAAW;EAC5B,MAAM,EAAE,OAAO,YAAY,YAAY;AAEvC,SAAO;GACN,QAAQ;IACP,qBAAqB,EACpB,UAAU,EACT,UAAU,EACT,UAAU;;;;;;;;;;;;GAaV,EACD,EACD,CAAC;IACF,YAAY,EACX,YAAY,mJACZ,CAAC;IACF,qBAAqB,EACpB,MAAM,CACL;KACC,MAAM;KACN,OAAO,CACN,EAAE,KAAK,cAAc,EACrB,GAAG,QAAQ,KAAK,SAAS,EAAE,KAAK,EAAE,CAClC;KACD,CACD,EACD,CAAC;IACF,UAAU,EACT,OAAO,CAAC,eAAe,EACvB,CAAC;IACF,iBAAiB,EAChB,YAAY;KACX,iBAAiB,uBAAuB,SAAS;KACjD,SAAS,EACR,OAAO,UACP;KACD,EACD,CAAC;IACF,eAAe,EACd,UAAU,CACT;KACC,OAAO;KACP,KAAK;KACL,CACD,EACD,CAAC;IACF;GACD,OAAO,EACN,oBAAoB;;8BAEM,KAAK,UAAU;IACxC,KAAK;IACL,OAAO,MAAM,KAAK,IAAI,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC,CAAC;IACrD,gBAAgB;IAChB,QAAQ;IACR,UAAU;IACV,GAAG;IACH,CAAC,CAAC;GAEH;GACD,SAAS,QAAQ,MACd,CACA;IACC,UAAU,CAAC,aAAa;IACxB,OAAO,aAAa;IACpB,CACD,GACA;GACH;;CAEF,aAAa;AACZ,SAAO,EACN,QAAQ;GACP,wBAAwB,EACvB,cAAc;IACb;IACA;IACA;IACA;IACA,EACD,CAAC;GACF,iBAAiB,EAChB,OAAO;IACN;IACA;IACA;IACA;IACA;IACA,EACD,CAAC;GACF,qBAAqB,EACpB,WAAW,CAAC,SAAS,OAAO,EAC5B,CAAC;GACF,EACD;;CAEF,CAAC"}