{"version":3,"file":"blockAllContributors.js","names":[],"sources":["../../src/blocks/blockAllContributors.ts"],"sourcesContent":["import _ from \"lodash\";\n\nimport { base } from \"../base.js\";\nimport { startingOwnerContributions } from \"../data/contributions.js\";\nimport { Contributor } from \"../schemas.js\";\nimport { resolveUses } from \"./actions/resolveUses.js\";\nimport { blockPrettier } from \"./blockPrettier.js\";\nimport { blockREADME } from \"./blockREADME.js\";\nimport { blockRepositorySecrets } from \"./blockRepositorySecrets.js\";\nimport { createSoloWorkflowFile } from \"./files/createSoloWorkflowFile.js\";\nimport { CommandPhase } from \"./phases.js\";\n\nexport const blockAllContributors = base.createBlock({\n\tabout: {\n\t\tname: \"AllContributors\",\n\t},\n\tproduce({ options }) {\n\t\tconst contributions = options.contributors?.length;\n\t\tconst ownerContributions = Array.from(\n\t\t\tnew Set(\n\t\t\t\t[\n\t\t\t\t\toptions.contributors?.find(\n\t\t\t\t\t\t(contributor) =>\n\t\t\t\t\t\t\tcontributor.login.toLowerCase() === options.owner.toLowerCase(),\n\t\t\t\t\t)?.contributions,\n\t\t\t\t\tstartingOwnerContributions,\n\t\t\t\t]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.flat(),\n\t\t\t),\n\t\t);\n\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockPrettier({\n\t\t\t\t\tignores: [\"/.all-contributorsrc\"],\n\t\t\t\t}),\n\t\t\t\tblockREADME({\n\t\t\t\t\tbadges: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\talt: `üë™ All Contributors: ${contributions}`,\n\t\t\t\t\t\t\tcomments: {\n\t\t\t\t\t\t\t\tafter: `\n<!-- ALL-CONTRIBUTORS-BADGE:END -->\n\\t<!-- prettier-ignore-end -->`,\n\t\t\t\t\t\t\t\tbefore: `<!-- prettier-ignore-start -->\n\\t<!-- ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section -->\n\\t`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thref: \"#contributors\",\n\t\t\t\t\t\t\tsrc: `https://img.shields.io/badge/%F0%9F%91%AA_all_contributors-${contributions}-21bb42.svg`,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tsections: options.contributors\n\t\t\t\t\t\t? [printAllContributorsTable(options.contributors)]\n\t\t\t\t\t\t: undefined,\n\t\t\t\t}),\n\t\t\t\tblockRepositorySecrets({\n\t\t\t\t\tsecrets: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdescription: \"a GitHub PAT with repo and workflow permissions\",\n\t\t\t\t\t\t\tname: \"ACCESS_TOKEN\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t\".all-contributorsrc\": JSON.stringify(\n\t\t\t\t\t{\n\t\t\t\t\t\tbadgeTemplate:\n\t\t\t\t\t\t\t'\t<a href=\"#contributors\" target=\"_blank\"><img alt=\"üë™ All Contributors: <%= contributors.length %>\" src=\"https://img.shields.io/badge/%F0%9F%91%AA_all_contributors-<%= contributors.length %>-21bb42.svg\" /></a>',\n\t\t\t\t\t\tcommitType: \"docs\",\n\t\t\t\t\t\tcontributors: options.contributors ?? [],\n\t\t\t\t\t\tcontributorsPerLine: 7,\n\t\t\t\t\t\tcontributorsSortAlphabetically: true,\n\t\t\t\t\t\tfiles: [\"README.md\"],\n\t\t\t\t\t\tprojectName: options.repository,\n\t\t\t\t\t\tprojectOwner: options.owner,\n\t\t\t\t\t\trepoType: \"github\",\n\t\t\t\t\t},\n\t\t\t\t\tnull,\n\t\t\t\t\t2,\n\t\t\t\t),\n\t\t\t\t\".github\": {\n\t\t\t\t\tworkflows: {\n\t\t\t\t\t\t\"contributors.yaml\": createSoloWorkflowFile({\n\t\t\t\t\t\t\tname: \"Contributors\",\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tpush: {\n\t\t\t\t\t\t\t\t\tbranches: [\"main\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"actions/checkout\",\n\t\t\t\t\t\t\t\t\t\t\"v4\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\twith: { \"fetch-depth\": 0 },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{ uses: \"./.github/actions/prepare\" },\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tenv: { GITHUB_TOKEN: \"${{ secrets.ACCESS_TOKEN }}\" },\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"JoshuaKGoldberg/all-contributors-auto-action\",\n\t\t\t\t\t\t\t\t\t\t\"v0.5.0\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tscripts: [\n\t\t\t\t{\n\t\t\t\t\tcommands: [\n\t\t\t\t\t\t`pnpx all-contributors-cli@6.23.1 add ${options.owner} ${ownerContributions.join(\",\")}`,\n\t\t\t\t\t],\n\t\t\t\t\tphase: CommandPhase.Process,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t},\n});\n\nfunction printAllContributorsTable(contributors: Contributor[]) {\n\treturn [\n\t\t`## Contributors`,\n\t\t``,\n\t\t`<!-- spellchecker: disable -->`,\n\t\t`<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->`,\n\t\t`<!-- prettier-ignore-start -->`,\n\t\t`<table>`,\n\t\t`  <tbody>`,\n\t\t`    <tr>`,\n\t\t// This intentionally uses the same sort as all-contributors-cli:\n\t\t// https://github.com/all-contributors/cli/blob/74bc388bd6f0ae2658e6495e9d3781d737438a97/src/generate/index.js#L76\n\t\t..._.sortBy(contributors, \"name\").flatMap((contributor, i) => {\n\t\t\tconst row = printContributorCell(contributor);\n\n\t\t\treturn i && i % 7 === 0 ? [`    </tr>`, `    <tr>`, row] : [row];\n\t\t}),\n\t\t`    </tr>`,\n\t\t`  </tbody>`,\n\t\t`</table>`,\n\t\t``,\n\t\t`<!-- prettier-ignore-end -->`,\n\t\t``,\n\t\t`<!-- ALL-CONTRIBUTORS-LIST:END -->`,\n\t\t`<!-- spellchecker: enable -->`,\n\t].join(\"\\n\");\n}\n\nfunction printContributorCell(contributor: Contributor) {\n\treturn [\n\t\t`      <td align=\"center\" valign=\"top\" width=\"14.28%\">`,\n\t\t`<a href=\"${contributor.profile}\">`,\n\t\t`<img src=\"${contributor.avatar_url}?s=100\" width=\"100px;\" alt=\"${contributor.name}\"/>`,\n\t\t`<br />`,\n\t\t`<sub><b>${contributor.name}</b></sub></a><br />`,\n\t\tcontributor.contributions\n\t\t\t.map((contribution) => {\n\t\t\t\tswitch (contribution) {\n\t\t\t\t\tcase \"bug\":\n\t\t\t\t\t\treturn `<a href=\"https://github.com/JoshuaKGoldberg/create-typescript-app/issues?q=author%3A${contributor.login}\" title=\"Bug reports\">üêõ</a>`;\n\t\t\t\t\tcase \"code\":\n\t\t\t\t\t\treturn `<a href=\"https://github.com/JoshuaKGoldberg/create-typescript-app/commits?author=${contributor.login}\" title=\"Code\">üíª</a>`;\n\t\t\t\t\tcase \"design\":\n\t\t\t\t\t\treturn `<a href=\"#design-${contributor.login}\" title=\"Design\">üé®</a>`;\n\t\t\t\t\tcase \"doc\":\n\t\t\t\t\t\treturn `<a href=\"https://github.com/JoshuaKGoldberg/create-typescript-app/commits?author=${contributor.login}\" title=\"Documentation\">üìñ</a>`;\n\t\t\t\t\tcase \"ideas\":\n\t\t\t\t\t\treturn `<a href=\"#ideas-${contributor.login}\" title=\"Ideas, Planning, & Feedback\">ü§î</a>`;\n\t\t\t\t\tcase \"infra\":\n\t\t\t\t\t\treturn `<a href=\"#infra-${contributor.login}\" title=\"Infrastructure (Hosting, Build-Tools, etc)\">üöá</a>`;\n\t\t\t\t\tcase \"maintenance\":\n\t\t\t\t\t\treturn `<a href=\"#maintenance-${contributor.login}\" title=\"Maintenance\">üöß</a>`;\n\t\t\t\t\tcase \"review\":\n\t\t\t\t\t\treturn `<a href=\"https://github.com/JoshuaKGoldberg/create-typescript-app/pulls?q=is%3Apr+reviewed-by%3A${contributor.login}\" title=\"Reviewed Pull Requests\">üëÄ</a>`;\n\t\t\t\t\tcase \"test\":\n\t\t\t\t\t\treturn `<a href=\"https://github.com/JoshuaKGoldberg/create-typescript-app/commits?author=${contributor.login}\" title=\"Tests\">‚ö†Ô∏è</a>`;\n\t\t\t\t\tcase \"tool\":\n\t\t\t\t\t\treturn `<a href=\"#tool-${contributor.login}\" title=\"Tools\">üîß</a>`;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.join(\" \"),\n\t\t`</td>`,\n\t].join(\"\");\n}\n"],"mappings":"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"}