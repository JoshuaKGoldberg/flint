{"version":3,"file":"blockESLintPlugin.js","names":[],"sources":["../../src/blocks/blockESLintPlugin.ts"],"sourcesContent":["import { base } from \"../base.js\";\nimport { blockCSpell } from \"./blockCSpell.js\";\nimport { blockDevelopmentDocs } from \"./blockDevelopmentDocs.js\";\nimport { blockESLint } from \"./blockESLint.js\";\nimport { blockGitHubActionsCI } from \"./blockGitHubActionsCI.js\";\nimport { blockPackageJson } from \"./blockPackageJson.js\";\nimport { blockREADME } from \"./blockREADME.js\";\nimport { blockVitest } from \"./blockVitest.js\";\nimport { blockESLintPluginIntake } from \"./eslint/blockESLintPluginIntake.js\";\nimport { getScriptFileExtension } from \"./eslint/getScriptFileExtension.js\";\nimport { zConfigEmoji } from \"./eslint/schemas.js\";\nimport { intakeFile } from \"./intake/intakeFile.js\";\nimport { CommandPhase } from \"./phases.js\";\n\nexport const blockESLintPlugin = base.createBlock({\n\tabout: {\n\t\tname: \"ESLint Plugin\",\n\t},\n\taddons: {\n\t\tconfigEmoji: zConfigEmoji,\n\t},\n\tintake({ files }) {\n\t\tconst docGeneratorConfigRaw = intakeFile(files, [\n\t\t\t[\".eslint-doc-generatorrc.js\", \".eslint-doc-generatorrc.mjs\"],\n\t\t]);\n\n\t\treturn docGeneratorConfigRaw\n\t\t\t? blockESLintPluginIntake(docGeneratorConfigRaw[0])\n\t\t\t: undefined;\n\t},\n\tproduce({ addons, options }) {\n\t\tconst { configEmoji } = addons;\n\t\tconst configFileName = `.eslint-doc-generatorrc.${options.type === \"commonjs\" ? \"mjs\" : \"js\"}`;\n\t\tconst pluginName = options.repository\n\t\t\t.replace(/^eslint-plugin-/, \"\")\n\t\t\t.replaceAll(/-\\w/g, (matched) => matched[1].toUpperCase());\n\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockCSpell({\n\t\t\t\t\twords: [\"eslint-doc-generatorrc\"],\n\t\t\t\t}),\n\t\t\t\tblockDevelopmentDocs({\n\t\t\t\t\tsections: {\n\t\t\t\t\t\tBuilding: {\n\t\t\t\t\t\t\tinnerSections: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcontents: `\nRun [\\`eslint-doc-generator\\`](https://github.com/bmish/eslint-doc-generator) to generate Markdown files documenting rules.\n\n\\`\\`\\`shell\npnpm build:docs\n\\`\\`\\`\n\t\t`,\n\t\t\t\t\t\t\t\t\theading: \"Building Docs\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLinting: {\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t\t`- \\`pnpm lint:docs\\` ([eslint-doc-generator](https://github.com/bmish/eslint-doc-generator)): Generates and validates documentation for ESLint rules`,\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockESLint({\n\t\t\t\t\textensions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\textends: ['eslintPlugin.configs[\"flat/recommended\"]'],\n\t\t\t\t\t\t\tfiles: [getScriptFileExtension(options)],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tignores: [configFileName, \"docs/rules/*/*.ts\"],\n\t\t\t\t\timports: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\t\tpackageName: \"eslint-plugin-eslint-plugin\",\n\t\t\t\t\t\t\t\tversion: \"6.4.0\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tspecifier: \"eslintPlugin\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockGitHubActionsCI({\n\t\t\t\t\tjobs: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"Lint Docs\",\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{ run: \"pnpm build || exit 0\" },\n\t\t\t\t\t\t\t\t{ run: \"pnpm lint:docs\" },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockREADME({\n\t\t\t\t\tdefaultUsage: [\n\t\t\t\t\t\t`Add this plugin to the list of plugins in your [ESLint configuration file](https://eslint.org/docs/latest/use/configure/configuration-files):\n\n\\`\\`\\`shell\nnpm i ${options.repository} -D\n\\`\\`\\`\n\n\\`\\`\\`ts\nimport ${pluginName} from \"${options.repository}\";\n\nexport default [\n\t// (other plugins)\n\t${pluginName}.configs.recommended, // ðŸ‘ˆ\n];\n\\`\\`\\`\n\n### Rules\n\nThese are all set to \\`\"error\"\\` in the recommended config:\n\n<!-- begin auto-generated rules list --><!-- end auto-generated rules list -->`,\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockPackageJson({\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdependencies: {\n\t\t\t\t\t\t\t\"@typescript-eslint/utils\": \"^8.29.0\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdevDependencies: {\n\t\t\t\t\t\t\t\"@typescript-eslint/rule-tester\": \"8.29.1\",\n\t\t\t\t\t\t\t\"eslint-doc-generator\": \"2.1.0\",\n\t\t\t\t\t\t\t\"eslint-plugin-eslint-plugin\": \"6.4.0\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tscripts: {\n\t\t\t\t\t\t\t\"build:docs\": \"pnpm build --no-dts && eslint-doc-generator\",\n\t\t\t\t\t\t\t\"lint:docs\": \"eslint-doc-generator --check\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockVitest({\n\t\t\t\t\tcoverage: {\n\t\t\t\t\t\texclude: [\"src/index.ts\", \"src/rules/index.ts\"],\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t[configFileName]: `import prettier from \"prettier\";\n\n/** @type {import('eslint-doc-generator').GenerateOptions} */\nconst config = {\n\t${configEmoji ? `configEmoji: ${JSON.stringify(configEmoji)},\\n\\t` : \"\"}postprocess: async (content, path) =>\n\t\tprettier.format(content, {\n\t\t\t...(await prettier.resolveConfig(path)),\n\t\t\tparser: \"markdown\",\n\t\t}),\n\truleDocTitleFormat: \"name\",\n};\n\nexport default config;\n`,\n\t\t\t},\n\t\t\tscripts: [\n\t\t\t\t{\n\t\t\t\t\tcommands: [\"pnpm build\"],\n\t\t\t\t\tphase: CommandPhase.Build,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcommands: [\"pnpm eslint-doc-generator --init-rule-docs\"],\n\t\t\t\t\tphase: CommandPhase.Process,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t},\n\tsetup({ options }) {\n\t\tconst pluginName = options.repository.replace(\"eslint-plugin-\", \"\");\n\n\t\treturn {\n\t\t\tfiles: {\n\t\t\t\tsrc: {\n\t\t\t\t\t\"index.ts\": `import Module from \"node:module\";\n\nimport { rules } from \"./rules/index.js\";\n\nconst require = Module.createRequire(import.meta.url);\n\nconst { name, version } =\n\t// \\`import\\`ing here would bypass the TSConfig's \\`\"rootDir\": \"src\"\\`\n\trequire(\"../package.json\") as typeof import(\"../package.json\");\n\nexport const plugin = {\n\tconfigs: {\n\t\tget recommended() {\n\t\t\treturn recommended;\n\t\t},\n\t},\n\tmeta: { name, version },\n\trules,\n};\n\nconst recommended = {\n\tplugins: {\n\t\t\"${pluginName}\": plugin,\n\t},\n\trules: Object.fromEntries(\n\t\tObject.keys(rules).map((rule) => [\\`${pluginName}/\\${rule}\\`, \"error\"]),\n\t),\n};\n\nexport { rules };\n\nexport default plugin;\n`,\n\t\t\t\t\trules: {\n\t\t\t\t\t\t\"enums.test.ts\": `import { rule } from \"./enums.js\";\nimport { ruleTester } from \"./ruleTester.js\";\n\nruleTester.run(\"enums\", rule, {\n\tinvalid: [\n\t\t{\n\t\t\tcode: \\`enum Values {}\\`,\n\t\t\terrors: [\n\t\t\t\t{\n\t\t\t\t\tcolumn: 1,\n\t\t\t\t\tendColumn: 15,\n\t\t\t\t\tendLine: 1,\n\t\t\t\t\tline: 1,\n\t\t\t\t\tmessageId: \"enum\",\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n\tvalid: [\\`const Values = {};\\`, \\`const Values = {} as const;\\`],\n});\n`,\n\t\t\t\t\t\t\"enums.ts\": `import { createRule } from \"../utils.js\";\n\nexport const rule = createRule({\n\tcreate(context) {\n\t\treturn {\n\t\t\tTSEnumDeclaration(node) {\n\t\t\t\tcontext.report({\n\t\t\t\t\tmessageId: \"enum\",\n\t\t\t\t\tnode,\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t},\n\tdefaultOptions: [],\n\tmeta: {\n\t\tdocs: {\n\t\t\tdescription: \"Avoid using TypeScript's enums.\",\n\t\t},\n\t\tmessages: {\n\t\t\tenum: \"This enum will not be allowed under TypeScript's --erasableSyntaxOnly.\",\n\t\t},\n\t\tschema: [],\n\t\ttype: \"problem\",\n\t},\n\tname: \"enums\",\n});\n`,\n\t\t\t\t\t\t\"index.ts\": `import { rule as enums } from \"./enums.js\";\n\nexport const rules = {\n\tenums,\n};\n`,\n\t\t\t\t\t\t\"ruleTester.ts\": `import { RuleTester } from \"@typescript-eslint/rule-tester\";\nimport * as vitest from \"vitest\";\n\nRuleTester.afterAll = vitest.afterAll;\nRuleTester.it = vitest.it;\nRuleTester.itOnly = vitest.it.only;\nRuleTester.describe = vitest.describe;\n\nexport const ruleTester = new RuleTester();\n`,\n\t\t\t\t\t},\n\t\t\t\t\t\"utils.ts\": `import { ESLintUtils } from \"@typescript-eslint/utils\";\n\nexport const createRule = ESLintUtils.RuleCreator(\n\t(name) =>\n\t\t\\`https://github.com/${options.owner}/${options.repository}/blob/main/docs/rules/\\${name}.md\\`,\n);\n`,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;;;;;;;;AAcA,MAAa,oBAAoB,KAAK,YAAY;CACjD,OAAO,EACN,MAAM,iBACN;CACD,QAAQ,EACP,aAAa,cACb;CACD,OAAO,EAAE,SAAS;EACjB,MAAM,wBAAwB,WAAW,OAAO,CAC/C,CAAC,8BAA8B,8BAA8B,CAC7D,CAAC;AAEF,SAAO,wBACJ,wBAAwB,sBAAsB,GAAG,GACjD;;CAEJ,QAAQ,EAAE,QAAQ,WAAW;EAC5B,MAAM,EAAE,gBAAgB;EACxB,MAAM,iBAAiB,2BAA2B,QAAQ,SAAS,aAAa,QAAQ;EACxF,MAAM,aAAa,QAAQ,WACzB,QAAQ,mBAAmB,GAAG,CAC9B,WAAW,SAAS,YAAY,QAAQ,GAAG,aAAa,CAAC;AAE3D,SAAO;GACN,QAAQ;IACP,YAAY,EACX,OAAO,CAAC,yBAAyB,EACjC,CAAC;IACF,qBAAqB,EACpB,UAAU;KACT,UAAU,EACT,eAAe,CACd;MACC,UAAU;;;;;;;MAOV,SAAS;MACT,CACD,EACD;KACD,SAAS,EACR,UAAU,EACT,OAAO,CACN,uJACA,EACD,EACD;KACD,EACD,CAAC;IACF,YAAY;KACX,YAAY,CACX;MACC,SAAS,CAAC,6CAA2C;MACrD,OAAO,CAAC,uBAAuB,QAAQ,CAAC;MACxC,CACD;KACD,SAAS,CAAC,gBAAgB,oBAAoB;KAC9C,SAAS,CACR;MACC,QAAQ;OACP,aAAa;OACb,SAAS;OACT;MACD,WAAW;MACX,CACD;KACD,CAAC;IACF,qBAAqB,EACpB,MAAM,CACL;KACC,MAAM;KACN,OAAO,CACN,EAAE,KAAK,wBAAwB,EAC/B,EAAE,KAAK,kBAAkB,CACzB;KACD,CACD,EACD,CAAC;IACF,YAAY,EACX,cAAc,CACb;;;QAGE,QAAQ,WAAW;;;;SAIlB,WAAW,SAAS,QAAQ,WAAW;;;;GAI7C,WAAW;;;;;;;;gFASR,EACD,CAAC;IACF,iBAAiB,EAChB,YAAY;KACX,cAAc,EACb,4BAA4B,WAC5B;KACD,iBAAiB;MAChB,kCAAkC;MAClC,wBAAwB;MACxB,+BAA+B;MAC/B;KACD,SAAS;MACR,cAAc;MACd,aAAa;MACb;KACD,EACD,CAAC;IACF,YAAY,EACX,UAAU,EACT,SAAS,CAAC,gBAAgB,qBAAqB,EAC/C,EACD,CAAC;IACF;GACD,OAAO,GACL,iBAAiB;;;;GAInB,cAAc,gBAAgB,KAAK,UAAU,YAAY,CAAC,SAAS,GAAG;;;;;;;;;GAUrE;GACD,SAAS,CACR;IACC,UAAU,CAAC,aAAa;IACxB,OAAO,aAAa;IACpB,EACD;IACC,UAAU,CAAC,6CAA6C;IACxD,OAAO,aAAa;IACpB,CACD;GACD;;CAEF,MAAM,EAAE,WAAW;EAClB,MAAM,aAAa,QAAQ,WAAW,QAAQ,kBAAkB,GAAG;AAEnE,SAAO,EACN,OAAO,EACN,KAAK;GACJ,YAAY;;;;;;;;;;;;;;;;;;;;;;KAsBZ,WAAW;;;wCAGwB,WAAW;;;;;;;;GAQ9C,OAAO;IACN,iBAAiB;;;;;;;;;;;;;;;;;;;;;IAqBjB,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;IA2BZ,YAAY;;;;;;IAMZ,iBAAiB;;;;;;;;;;IAUjB;GACD,YAAY;;;;yBAIQ,QAAQ,MAAM,GAAG,QAAQ,WAAW;;;GAGxD,EACD,EACD;;CAEF,CAAC"}