{"version":3,"file":"blockCSpell.js","names":["addons"],"sources":["../../src/blocks/blockCSpell.ts"],"sourcesContent":["import JSON5 from \"json5\";\nimport { getObjectStringsDeep } from \"object-strings-deep\";\nimport { z } from \"zod\";\n\nimport { base } from \"../base.js\";\nimport { getPackageDependencies } from \"../data/packageData.js\";\nimport { resolveBin } from \"../utils/resolveBin.js\";\nimport { blockDevelopmentDocs } from \"./blockDevelopmentDocs.js\";\nimport { blockGitHubActionsCI } from \"./blockGitHubActionsCI.js\";\nimport { blockPackageJson } from \"./blockPackageJson.js\";\nimport { blockRemoveWorkflows } from \"./blockRemoveWorkflows.js\";\nimport { blockVSCode } from \"./blockVSCode.js\";\nimport { intakeFile } from \"./intake/intakeFile.js\";\nimport { CommandPhase } from \"./phases.js\";\n\nconst filesGlob = `\"**\" \".github/**/*\"`;\n\nconst addons = {\n\tignorePaths: z.array(z.string()).default([]),\n\twords: z.array(z.string()).default([]),\n};\n\nconst zAddons = z.object(addons);\n\nexport const blockCSpell = base.createBlock({\n\tabout: {\n\t\tname: \"CSpell\",\n\t},\n\taddons,\n\tintake({ files }) {\n\t\tconst cspellJson = intakeFile(files, [\"cspell.json\"]);\n\t\tif (!cspellJson) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { data } = zAddons.safeParse(JSON5.parse<unknown>(cspellJson[0]));\n\t\tif (!data) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn data;\n\t},\n\tproduce({ addons, options }) {\n\t\tconst { ignorePaths, words } = addons;\n\n\t\tconst allWords = Array.from(\n\t\t\tnew Set([...(options.words ?? []), ...words]),\n\t\t).sort();\n\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockDevelopmentDocs({\n\t\t\t\t\tsections: {\n\t\t\t\t\t\tLinting: {\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t\t`- \\`pnpm lint:spelling\\` ([cspell](https://cspell.org)): Spell checks across all source files`,\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tblockVSCode({\n\t\t\t\t\textensions: [\"streetsidesoftware.code-spell-checker\"],\n\t\t\t\t}),\n\t\t\t\tblockGitHubActionsCI({\n\t\t\t\t\tjobs: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"Lint Spelling\",\n\t\t\t\t\t\t\tsteps: [{ run: \"pnpm lint:spelling\" }],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockPackageJson({\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdevDependencies: getPackageDependencies(\"cspell\"),\n\t\t\t\t\t\tscripts: {\n\t\t\t\t\t\t\t\"lint:spelling\": `cspell ${filesGlob}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\tfiles: {\n\t\t\t\t\"cspell.json\": JSON.stringify({\n\t\t\t\t\tdictionaries: [\"npm\", \"node\", \"typescript\"],\n\t\t\t\t\tignorePaths: Array.from(\n\t\t\t\t\t\tnew Set([\n\t\t\t\t\t\t\t\".github\",\n\t\t\t\t\t\t\t\"CHANGELOG.md\",\n\t\t\t\t\t\t\t\"lib\",\n\t\t\t\t\t\t\t\"node_modules\",\n\t\t\t\t\t\t\t\"pnpm-lock.yaml\",\n\t\t\t\t\t\t\t...ignorePaths,\n\t\t\t\t\t\t]),\n\t\t\t\t\t).sort(),\n\t\t\t\t\t...(allWords.length && { words: allWords }),\n\t\t\t\t}),\n\t\t\t},\n\t\t};\n\t},\n\tsetup({ options }) {\n\t\tconst wordArgs = getObjectStringsDeep(options)\n\t\t\t.map((word) => `--words \"${word.replaceAll(`\"`, \" \")}\"`)\n\t\t\t.join(\" \");\n\n\t\treturn {\n\t\t\tscripts: [\n\t\t\t\t{\n\t\t\t\t\tcommands: [\n\t\t\t\t\t\t`node ${resolveBin(\"cspell-populate-words/bin/index.mjs\")} ${wordArgs}`,\n\t\t\t\t\t],\n\t\t\t\t\tphase: CommandPhase.Process,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t},\n\ttransition() {\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockRemoveWorkflows({\n\t\t\t\t\tworkflows: [\"lint-spelling\", \"spelling\"],\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;;;;;;;;AAeA,MAAM,YAAY;AAElB,MAAM,SAAS;CACd,aAAa,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC;CAC5C,OAAO,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAC;CACtC;AAED,MAAM,UAAU,EAAE,OAAO,OAAO;AAEhC,MAAa,cAAc,KAAK,YAAY;CAC3C,OAAO,EACN,MAAM,UACN;CACD;CACA,OAAO,EAAE,SAAS;EACjB,MAAM,aAAa,WAAW,OAAO,CAAC,cAAc,CAAC;AACrD,MAAI,CAAC,WACJ;EAGD,MAAM,EAAE,SAAS,QAAQ,UAAU,MAAM,MAAe,WAAW,GAAG,CAAC;AACvE,MAAI,CAAC,KACJ;AAGD,SAAO;;CAER,QAAQ,EAAE,kBAAQ,WAAW;EAC5B,MAAM,EAAE,aAAa,UAAUA;EAE/B,MAAM,WAAW,MAAM,KACtB,IAAI,IAAI,CAAC,GAAI,QAAQ,SAAS,EAAE,EAAG,GAAG,MAAM,CAAC,CAC7C,CAAC,MAAM;AAER,SAAO;GACN,QAAQ;IACP,qBAAqB,EACpB,UAAU,EACT,SAAS,EACR,UAAU,EACT,OAAO,CACN,gGACA,EACD,EACD,EACD,EACD,CAAC;IACF,YAAY,EACX,YAAY,CAAC,wCAAwC,EACrD,CAAC;IACF,qBAAqB,EACpB,MAAM,CACL;KACC,MAAM;KACN,OAAO,CAAC,EAAE,KAAK,sBAAsB,CAAC;KACtC,CACD,EACD,CAAC;IACF,iBAAiB,EAChB,YAAY;KACX,iBAAiB,uBAAuB,SAAS;KACjD,SAAS,EACR,iBAAiB,UAAU,aAC3B;KACD,EACD,CAAC;IACF;GACD,OAAO,EACN,eAAe,KAAK,UAAU;IAC7B,cAAc;KAAC;KAAO;KAAQ;KAAa;IAC3C,aAAa,MAAM,KAClB,IAAI,IAAI;KACP;KACA;KACA;KACA;KACA;KACA,GAAG;KACH,CAAC,CACF,CAAC,MAAM;IACR,GAAI,SAAS,UAAU,EAAE,OAAO,UAAU;IAC1C,CAAC,EACF;GACD;;CAEF,MAAM,EAAE,WAAW;EAClB,MAAM,WAAW,qBAAqB,QAAQ,CAC5C,KAAK,SAAS,YAAY,KAAK,WAAW,KAAK,IAAI,CAAC,GAAG,CACvD,KAAK,IAAI;AAEX,SAAO,EACN,SAAS,CACR;GACC,UAAU,CACT,QAAQ,WAAW,sCAAsC,CAAC,GAAG,WAC7D;GACD,OAAO,aAAa;GACpB,CACD,EACD;;CAEF,aAAa;AACZ,SAAO,EACN,QAAQ,CACP,qBAAqB,EACpB,WAAW,CAAC,iBAAiB,WAAW,EACxC,CAAC,CACF,EACD;;CAEF,CAAC"}