{"version":3,"file":"blockCodecov.js","names":["step"],"sources":["../../src/blocks/blockCodecov.ts"],"sourcesContent":["import { z } from \"zod\";\n\nimport { base } from \"../base.js\";\nimport { resolveUses } from \"./actions/resolveUses.js\";\nimport { intakeFileYamlSteps } from \"./actions/steps.js\";\nimport { blockGitHubApps } from \"./blockGitHubApps.js\";\nimport { blockREADME } from \"./blockREADME.js\";\nimport { blockRemoveFiles } from \"./blockRemoveFiles.js\";\nimport { blockVitest } from \"./blockVitest.js\";\n\nexport const blockCodecov = base.createBlock({\n\tabout: {\n\t\tname: \"Codecov\",\n\t},\n\taddons: {\n\t\tenv: z.record(z.string(), z.string()).optional(),\n\t},\n\tintake({ files }) {\n\t\tconst steps = intakeFileYamlSteps(\n\t\t\tfiles,\n\t\t\t[\".github\", \"workflows\", \"ci.yaml\"],\n\t\t\t[\"jobs\", \"test\", \"steps\"],\n\t\t);\n\t\tif (!steps) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst step = steps.find(\n\t\t\t(step) =>\n\t\t\t\ttypeof step.uses === \"string\" &&\n\t\t\t\tstep.uses.startsWith(\"codecov/codecov-action\"),\n\t\t);\n\t\tif (!step) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tenv: step.env,\n\t\t};\n\t},\n\tproduce({ addons, options }) {\n\t\tconst { env } = addons;\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockGitHubApps({\n\t\t\t\t\tapps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"Codecov\",\n\t\t\t\t\t\t\turl: \"https://github.com/apps/codecov\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockREADME({\n\t\t\t\t\tbadges: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\talt: \"ðŸ§ª Coverage\",\n\t\t\t\t\t\t\thref: `https://codecov.io/gh/${options.owner}/${options.repository}`,\n\t\t\t\t\t\t\tsrc: `https://img.shields.io/codecov/c/github/${options.owner}/${options.repository}?label=%F0%9F%A7%AA%20coverage`,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tblockVitest({\n\t\t\t\t\tactionSteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t...(env && { env }),\n\t\t\t\t\t\t\tif: \"always()\",\n\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\"codecov/codecov-action\",\n\t\t\t\t\t\t\t\t\"v3\",\n\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n\ttransition() {\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockRemoveFiles({ files: [\".github/codecov.yaml\", \"codecov.yaml\"] }),\n\t\t\t],\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;;;AAUA,MAAa,eAAe,KAAK,YAAY;CAC5C,OAAO,EACN,MAAM,WACN;CACD,QAAQ,EACP,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,EAAE,QAAQ,CAAC,CAAC,UAAU,EAChD;CACD,OAAO,EAAE,SAAS;EACjB,MAAM,QAAQ,oBACb,OACA;GAAC;GAAW;GAAa;GAAU,EACnC;GAAC;GAAQ;GAAQ;GAAQ,CACzB;AACD,MAAI,CAAC,MACJ;EAGD,MAAM,OAAO,MAAM,MACjB,WACA,OAAOA,OAAK,SAAS,YACrBA,OAAK,KAAK,WAAW,yBAAyB,CAC/C;AACD,MAAI,CAAC,KACJ;AAGD,SAAO,EACN,KAAK,KAAK,KACV;;CAEF,QAAQ,EAAE,QAAQ,WAAW;EAC5B,MAAM,EAAE,QAAQ;AAChB,SAAO,EACN,QAAQ;GACP,gBAAgB,EACf,MAAM,CACL;IACC,MAAM;IACN,KAAK;IACL,CACD,EACD,CAAC;GACF,YAAY,EACX,QAAQ,CACP;IACC,KAAK;IACL,MAAM,yBAAyB,QAAQ,MAAM,GAAG,QAAQ;IACxD,KAAK,2CAA2C,QAAQ,MAAM,GAAG,QAAQ,WAAW;IACpF,CACD,EACD,CAAC;GACF,YAAY,EACX,aAAa,CACZ;IACC,GAAI,OAAO,EAAE,KAAK;IAClB,IAAI;IACJ,MAAM,YACL,0BACA,MACA,QAAQ,kBACR;IACD,CACD,EACD,CAAC;GACF,EACD;;CAEF,aAAa;AACZ,SAAO,EACN,QAAQ,CACP,iBAAiB,EAAE,OAAO,CAAC,wBAAwB,eAAe,EAAE,CAAC,CACrE,EACD;;CAEF,CAAC"}