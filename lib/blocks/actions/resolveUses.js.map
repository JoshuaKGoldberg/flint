{"version":3,"file":"resolveUses.js","names":[],"sources":["../../../src/blocks/actions/resolveUses.ts"],"sourcesContent":["import { CachedFactory } from \"cached-factory\";\nimport semver from \"semver\";\n\nimport { WorkflowsVersions } from \"../../schemas.js\";\n\nconst semverCoercions = new CachedFactory((version: string) => {\n\treturn semver.coerce(version)?.toString() ?? \"0.0.0\";\n});\n\nexport function resolveUses(\n\taction: string,\n\tversion: string,\n\tworkflowsVersions?: WorkflowsVersions,\n) {\n\tif (!workflowsVersions || !(action in workflowsVersions)) {\n\t\treturn `${action}@${version}`;\n\t}\n\n\tconst workflowVersions = workflowsVersions[action];\n\n\tconst biggestVersion = Object.keys(workflowVersions).reduce(\n\t\t(highestVersion, potentialVersion) =>\n\t\t\tsemver.gt(\n\t\t\t\tsemverCoercions.get(potentialVersion),\n\t\t\t\tsemverCoercions.get(highestVersion),\n\t\t\t)\n\t\t\t\t? potentialVersion\n\t\t\t\t: highestVersion,\n\t\tversion,\n\t);\n\n\tif (!(biggestVersion in workflowVersions)) {\n\t\treturn `${action}@${biggestVersion}`;\n\t}\n\n\tconst atBiggestVersion = workflowVersions[biggestVersion];\n\n\treturn atBiggestVersion.hash\n\t\t? `${action}@${atBiggestVersion.hash} # ${biggestVersion}`\n\t\t: `${action}@${biggestVersion}`;\n}\n"],"mappings":";;;;AAKA,MAAM,kBAAkB,IAAI,eAAe,YAAoB;AAC9D,QAAO,OAAO,OAAO,QAAQ,EAAE,UAAU,IAAI;EAC5C;AAEF,SAAgB,YACf,QACA,SACA,mBACC;AACD,KAAI,CAAC,qBAAqB,EAAE,UAAU,mBACrC,QAAO,GAAG,OAAO,GAAG;CAGrB,MAAM,mBAAmB,kBAAkB;CAE3C,MAAM,iBAAiB,OAAO,KAAK,iBAAiB,CAAC,QACnD,gBAAgB,qBAChB,OAAO,GACN,gBAAgB,IAAI,iBAAiB,EACrC,gBAAgB,IAAI,eAAe,CACnC,GACE,mBACA,gBACJ,QACA;AAED,KAAI,EAAE,kBAAkB,kBACvB,QAAO,GAAG,OAAO,GAAG;CAGrB,MAAM,mBAAmB,iBAAiB;AAE1C,QAAO,iBAAiB,OACrB,GAAG,OAAO,GAAG,iBAAiB,KAAK,KAAK,mBACxC,GAAG,OAAO,GAAG"}