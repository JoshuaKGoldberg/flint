{"version":3,"file":"blockOctoGuide.js","names":[],"sources":["../../src/blocks/blockOctoGuide.ts"],"sourcesContent":["import { z } from \"zod\";\n\nimport { base } from \"../base.js\";\nimport { resolveUses } from \"./actions/resolveUses.js\";\nimport { intakeFileYamlSteps } from \"./actions/steps.js\";\nimport { blockRemoveFiles } from \"./blockRemoveFiles.js\";\nimport { createSoloWorkflowFile } from \"./files/createSoloWorkflowFile.js\";\n\nexport const blockOctoGuide = base.createBlock({\n\tabout: {\n\t\tname: \"OctoGuide\",\n\t},\n\taddons: {\n\t\tconfig: z.union([z.literal(\"recommended\"), z.literal(\"strict\")]).optional(),\n\t},\n\tintake({ files }) {\n\t\tconst steps = intakeFileYamlSteps(\n\t\t\tfiles,\n\t\t\t[\".github\", \"workflows\", \"octoguide.yaml\"],\n\t\t\t[\"jobs\", \"octoguide\", \"steps\"],\n\t\t);\n\t\tif (!steps) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst runOctoGuideStep = steps.find(\n\t\t\t(step) =>\n\t\t\t\ttypeof step.uses === \"string\" &&\n\t\t\t\tstep.uses.startsWith(\"JoshuaKGoldberg/octoguide\"),\n\t\t);\n\t\tif (!runOctoGuideStep) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tconfig: runOctoGuideStep.with?.config as\n\t\t\t\t| \"recommended\"\n\t\t\t\t| \"strict\"\n\t\t\t\t| undefined,\n\t\t};\n\t},\n\tproduce({ addons, options }) {\n\t\treturn {\n\t\t\tfiles: {\n\t\t\t\t\".github\": {\n\t\t\t\t\tworkflows: {\n\t\t\t\t\t\t\"octoguide.yaml\": createSoloWorkflowFile({\n\t\t\t\t\t\t\tif: \"${{ !endsWith(github.actor, '[bot]') }}\",\n\t\t\t\t\t\t\tname: \"OctoGuide\",\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tdiscussion: {\n\t\t\t\t\t\t\t\t\ttypes: [\"created\", \"edited\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdiscussion_comment: {\n\t\t\t\t\t\t\t\t\ttypes: [\"created\", \"deleted\", \"edited\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tissue_comment: {\n\t\t\t\t\t\t\t\t\ttypes: [\"created\", \"deleted\", \"edited\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tissues: {\n\t\t\t\t\t\t\t\t\ttypes: [\"edited\", \"opened\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpull_request_review_comment: {\n\t\t\t\t\t\t\t\t\ttypes: [\"created\", \"deleted\", \"edited\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpull_request_target: {\n\t\t\t\t\t\t\t\t\ttypes: [\"edited\", \"opened\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\tdiscussions: \"write\",\n\t\t\t\t\t\t\t\tissues: \"write\",\n\t\t\t\t\t\t\t\t\"pull-requests\": \"write\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tuses: resolveUses(\n\t\t\t\t\t\t\t\t\t\t\"JoshuaKGoldberg/octoguide\",\n\t\t\t\t\t\t\t\t\t\t\"0.11.1\",\n\t\t\t\t\t\t\t\t\t\toptions.workflowsVersions,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\twith: {\n\t\t\t\t\t\t\t\t\t\tconfig: addons.config ?? \"recommended\",\n\t\t\t\t\t\t\t\t\t\t\"github-token\": \"${{ secrets.GITHUB_TOKEN }}\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t},\n\ttransition() {\n\t\treturn {\n\t\t\taddons: [\n\t\t\t\tblockRemoveFiles({\n\t\t\t\t\tfiles: [\n\t\t\t\t\t\t\".github/workflows/accessibility-alt-text-bot.yaml\",\n\t\t\t\t\t\t\".github/workflows/compliance.yaml\",\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t};\n\t},\n});\n"],"mappings":";;;;;;;;AAQA,MAAa,iBAAiB,KAAK,YAAY;CAC9C,OAAO,EACN,MAAM,aACN;CACD,QAAQ,EACP,QAAQ,EAAE,MAAM,CAAC,EAAE,QAAQ,cAAc,EAAE,EAAE,QAAQ,SAAS,CAAC,CAAC,CAAC,UAAU,EAC3E;CACD,OAAO,EAAE,SAAS;EACjB,MAAM,QAAQ,oBACb,OACA;GAAC;GAAW;GAAa;GAAiB,EAC1C;GAAC;GAAQ;GAAa;GAAQ,CAC9B;AACD,MAAI,CAAC,MACJ;EAGD,MAAM,mBAAmB,MAAM,MAC7B,SACA,OAAO,KAAK,SAAS,YACrB,KAAK,KAAK,WAAW,4BAA4B,CAClD;AACD,MAAI,CAAC,iBACJ;AAGD,SAAO,EACN,QAAQ,iBAAiB,MAAM,QAI/B;;CAEF,QAAQ,EAAE,QAAQ,WAAW;AAC5B,SAAO,EACN,OAAO,EACN,WAAW,EACV,WAAW,EACV,kBAAkB,uBAAuB;GACxC,IAAI;GACJ,MAAM;GACN,IAAI;IACH,YAAY,EACX,OAAO,CAAC,WAAW,SAAS,EAC5B;IACD,oBAAoB,EACnB,OAAO;KAAC;KAAW;KAAW;KAAS,EACvC;IACD,eAAe,EACd,OAAO;KAAC;KAAW;KAAW;KAAS,EACvC;IACD,QAAQ,EACP,OAAO,CAAC,UAAU,SAAS,EAC3B;IACD,6BAA6B,EAC5B,OAAO;KAAC;KAAW;KAAW;KAAS,EACvC;IACD,qBAAqB,EACpB,OAAO,CAAC,UAAU,SAAS,EAC3B;IACD;GACD,aAAa;IACZ,aAAa;IACb,QAAQ;IACR,iBAAiB;IACjB;GACD,OAAO,CACN;IACC,MAAM,YACL,6BACA,UACA,QAAQ,kBACR;IACD,MAAM;KACL,QAAQ,OAAO,UAAU;KACzB,gBAAgB;KAChB;IACD,CACD;GACD,CAAC,EACF,EACD,EACD,EACD;;CAEF,aAAa;AACZ,SAAO,EACN,QAAQ,CACP,iBAAiB,EAChB,OAAO,CACN,qDACA,oCACA,EACD,CAAC,CACF,EACD;;CAEF,CAAC"}